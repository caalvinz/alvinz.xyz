<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"alvinz.xyz","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="alvin.z | THINK &amp; IMAGINE">
<meta property="og:url" content="https://alvinz.xyz/index.html">
<meta property="og:site_name" content="alvin.z | THINK &amp; IMAGINE">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="alvin.z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://alvinz.xyz/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>alvin.z | THINK & IMAGINE</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">alvin.z | THINK & IMAGINE</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">果 效 由 心 发 出</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2021/01/20/Mac%E5%AE%8C%E5%85%A8%E5%8D%B8%E8%BD%BDpython/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/20/Mac%E5%AE%8C%E5%85%A8%E5%8D%B8%E8%BD%BDpython/" class="post-title-link" itemprop="url">Mac完全卸载python</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-20 09:34:07" itemprop="dateCreated datePublished" datetime="2021-01-20T09:34:07-05:00">2021-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-24 09:04:31" itemprop="dateModified" datetime="2021-02-24T09:04:31-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Python安装之后，散落在电脑各处，删除起来比较麻烦！</p>
<p>在安装 Python 时，会自动建立如下目录：</p>
<ul>
<li><p>Python framework，即 Python 框架；<br>Mac 自带的 Python，其框架目录为：<br>System/Library/Frameworks/Python.framework<br>另外安装的 Python，其（默认）框架目录为：<br>/Library/Frameworks/Python.framework</p>
</li>
<li><p>Python 应用目录</p>
</li>
<li><p>指向 Python 的连接</p>
</li>
</ul>
<p>以下步骤都是在 Mac 终端进行，完整的删除python。</p>
<h3 id="查看python版本"><a href="#查看python版本" class="headerlink" title="查看python版本"></a>查看python版本</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3 --version</span><br><span class="line">Python 3.7.1</span><br></pre></td></tr></table></figure>

<h3 id="删除框架"><a href="#删除框架" class="headerlink" title="删除框架"></a>删除框架</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ls /Library/Frameworks/Python.framework/Versions/</span><br><span class="line">3.7</span><br><span class="line"></span><br><span class="line">$ sudo rm -rf /Library/Frameworks/Python.framework/Versions/3.7</span><br></pre></td></tr></table></figure>

<h3 id="删除应用目录"><a href="#删除应用目录" class="headerlink" title="删除应用目录"></a>删除应用目录</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /Applications</span><br><span class="line">$ sudo rm -rf Python\ 3.7/ #Python 3.7存在空格</span><br></pre></td></tr></table></figure>

<p>查看launchpad中python3的IDLE就被删除了</p>
<h3 id="删除-usr-local-bin-目录下指向的Python3的连接"><a href="#删除-usr-local-bin-目录下指向的Python3的连接" class="headerlink" title="删除/usr/local/bin 目录下指向的Python3的连接"></a>删除/usr/local/bin 目录下指向的Python3的连接</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/local/bin/ </span><br><span class="line">$ ls -l /usr/local/bin</span><br><span class="line">$ rm Python3.7相关的文件和链接 #Python3.7相关的文件和链接需要你自行确认</span><br></pre></td></tr></table></figure>

<p>Python3.7 对应的文件和链接最好删除干净；无法确认的文件和链接就上网搜一下bing.</p>
<h3 id="删除环境路径"><a href="#删除环境路径" class="headerlink" title="删除环境路径"></a>删除环境路径</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>删除Python3.7设置的环境路径。</p>
<h3 id="确认是否已经删除"><a href="#确认是否已经删除" class="headerlink" title="确认是否已经删除"></a>确认是否已经删除</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3</span><br><span class="line">-bash: python3: command not found</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2021/01/20/python%20%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/20/python%20%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">python 版本管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-20 09:34:07" itemprop="dateCreated datePublished" datetime="2021-01-20T09:34:07-05:00">2021-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-24 09:21:15" itemprop="dateModified" datetime="2021-02-24T09:21:15-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是pyenv"><a href="#什么是pyenv" class="headerlink" title="什么是pyenv"></a>什么是pyenv</h2><p><a target="_blank" rel="noopener" href="https://github.com/yyuu/pyenv">pyenv</a> 是 Python 版本管理工具。 pyenv 可以</p>
<ul>
<li>改变全局的 Python 版本</li>
<li>在系统中安装多个版本的 Python</li>
<li>设置目录级别的 Python 版本</li>
<li>创建和管理 virtual python environments 。</li>
</ul>
<h2 id="pyenv与virtualenv的区别"><a href="#pyenv与virtualenv的区别" class="headerlink" title="pyenv与virtualenv的区别"></a>pyenv与virtualenv的区别</h2><p>pyenv 通过修改系统环境变量来实现不同 Python 版本的切换。</p>
<p> virtualenv 通过将 Python 包安装到一个目录来作为 Python 包虚拟环境，通过切换目录来实现不同包环境间的切换。</p>
<h2 id="Pyenv安装"><a href="#Pyenv安装" class="headerlink" title="Pyenv安装"></a>Pyenv安装</h2><blockquote>
<p>前提：系统已经安装 git</p>
</blockquote>
<p>pyenv 提供了自动安装的工具，执行命令安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://pyenv.run</span><br></pre></td></tr></table></figure>

<p>执行安装后提供了如下工具：</p>
<ul>
<li><code>pyenv</code>: pyenv 工具自身</li>
<li><code>pyenv-virtualenv</code>: pyenv 的插件可以用来管理 vierual environments</li>
<li><code>pyenv-update</code>: 用来更新 pyenv 的插件</li>
<li><code>pyenv-doctor</code>: 验证 pyenv 和依赖是否安装的插件</li>
<li><code>pyenv-which-ext</code>: 用来寻找相同命令的插件</li>
</ul>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pyenv install --list <span class="comment"># 列出可安装版本</span></span><br><span class="line">pyenv install &lt;version&gt; <span class="comment"># 安装对应版本</span></span><br><span class="line">pyenv install -v &lt;version&gt; <span class="comment"># 安装对应版本，若发生错误，可以显示详细的错误信息</span></span><br><span class="line">pyenv versions <span class="comment"># 显示当前使用的python版本</span></span><br><span class="line">pyenv <span class="built_in">which</span> python <span class="comment"># 显示当前python安装路径</span></span><br><span class="line">pyenv global &lt;version&gt; <span class="comment"># 设置默认Python版本</span></span><br><span class="line">pyenv <span class="built_in">local</span> &lt;version&gt; <span class="comment"># 当前路径创建一个.python-version, 以后进入这个目录自动切换为该版本</span></span><br><span class="line">pyenv shell &lt;version&gt; <span class="comment"># 当前shell的session中启用某版本，优先级高于global 及 local</span></span><br></pre></td></tr></table></figure>

<h2 id="python-安装与卸载"><a href="#python-安装与卸载" class="headerlink" title="python 安装与卸载"></a>python 安装与卸载</h2><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 3.6.8   <span class="comment"># 安装 python</span></span><br></pre></td></tr></table></figure>

<p>安装后可以检视：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls ~/.pyenv/versions/</span><br></pre></td></tr></table></figure>

<p>从本机卸载对应版本的 Python 也特别简单：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv uninstall 3.6.8 <span class="comment"># 卸载 python</span></span><br></pre></td></tr></table></figure>

<p>或者直接删除掉 <code>~/.pyenv/versions/3.6.8</code> 对应的目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.pyenv/versions/3.6.8</span><br></pre></td></tr></table></figure>

<h2 id="查看可安装-Python-版本"><a href="#查看可安装-Python-版本" class="headerlink" title="查看可安装 Python 版本"></a>查看可安装 Python 版本</h2><p>使用如下命令查看可安装版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install -l</span><br></pre></td></tr></table></figure>

<h2 id="Python-版本切换"><a href="#Python-版本切换" class="headerlink" title="Python 版本切换"></a>Python 版本切换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pyenv global 2.7.3  <span class="comment"># 设置全局的 Python 版本，通过将版本号写入 ~/.pyenv/version 文件的方式。</span></span><br><span class="line">pyenv <span class="built_in">local</span> 2.7.3 <span class="comment"># 设置 Python 本地版本，通过将版本号写入当前目录下的 .python-version 文件的方式。通过这种方式设置的 Python 版本优先级较 global 高。</span></span><br></pre></td></tr></table></figure>

<p>pyenv 会从当前目录开始向上逐级查找 <code>.python-version</code> 文件，直到根目录为止。若找不到，就用 global 版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell &gt; local &gt; global</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pyenv shell 2.7.3 <span class="comment"># 设置 shell 的 Python 版本。</span></span><br><span class="line"></span><br><span class="line">pyenv shell --<span class="built_in">unset</span> <span class="comment"># 取消 shell的设置</span></span><br><span class="line"></span><br><span class="line">pyenv <span class="built_in">rehash</span>  <span class="comment"># 创建垫片路径（为所有已安装的可执行文件创建 shims，如：~/.pyenv/versions/*/bin/*，因此，每当你增删了 Python 版本或带有可执行文件的包（如 pip）以后，都应该执行一次本命令）</span></span><br></pre></td></tr></table></figure>

<h2 id="pyenv-virtualenv"><a href="#pyenv-virtualenv" class="headerlink" title="pyenv-virtualenv"></a>pyenv-virtualenv</h2><p>使用<strong>自动安装 pyenv</strong> 后，它会自动安装部分插件，通过 pyenv-virtualenv 插件可以很好的和 virtualenv 结合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;.pyenv&#x2F;plugins</span><br><span class="line">ll</span><br><span class="line">total 24K</span><br><span class="line">drwxr-xr-x 4 einverne einverne 4.0K Apr 22 10:55 pyenv-doctor</span><br><span class="line">drwxr-xr-x 5 einverne einverne 4.0K Apr 22 10:55 pyenv-installer</span><br><span class="line">drwxr-xr-x 4 einverne einverne 4.0K Apr 22 10:55 pyenv-update</span><br><span class="line">drwxr-xr-x 7 einverne einverne 4.0K Apr 22 10:55 pyenv-virtualenv</span><br><span class="line">drwxr-xr-x 4 einverne einverne 4.0K Apr 22 10:55 pyenv-which-ext</span><br><span class="line">drwxr-xr-x 5 einverne einverne 4.0K Apr 22 10:54 python-build</span><br></pre></td></tr></table></figure>

<h3 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv virtualenv 2.7.15 env-name</span><br></pre></td></tr></table></figure>

<p>若不指定 python 版本，会默认使用当前环境 python 版本。如果指定 Python 版本，则一定要是已经安装过的版本，否则会出错。环境的真实目录位于 <code>~/.pyenv/versions</code> 下</p>
<h3 id="列出当前虚拟环境"><a href="#列出当前虚拟环境" class="headerlink" title="列出当前虚拟环境"></a>列出当前虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pyenv virtualenvs</span><br><span class="line">pyenv activate env-name  # 激活虚拟环境</span><br><span class="line">pyenv deactivate #退出虚拟环境，回到系统环境</span><br></pre></td></tr></table></figure>

<h3 id="删除虚拟环境"><a href="#删除虚拟环境" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pyenv uninstall env-name</span><br><span class="line">rm -rf ~&#x2F;.pyenv&#x2F;versions&#x2F;env-name  # 或者删除其真实目录</span><br></pre></td></tr></table></figure>

<p>使用 pyenv 来管理 python，使用 pyenv-virtualenv 插件来管理多版本 python 包。此时，还需注意，当我们将项目运行的 env 环境部署到生产环境时，由于我们的 python 包是依赖 python 的，需要注意生产环境的 python 版本问题。</p>
<h2 id="可能碰到的问题"><a href="#可能碰到的问题" class="headerlink" title="可能碰到的问题"></a>可能碰到的问题</h2><p>当在mac上使用pyenv install 3.6.8的时候，我曾碰到这样的错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python-build: use readline from homebrew</span><br><span class="line">python-build: use zlib from xcode sdk</span><br><span class="line"></span><br><span class="line">BUILD FAILED (OS X 11.0 using python-build 20180424)</span><br><span class="line"></span><br><span class="line">Inspect or clean up the working tree at &#x2F;var&#x2F;folders&#x2F;gj&#x2F;x6v5vwdx1v7741fdfcxwmr100000gn&#x2F;T&#x2F;python-build.20200830033458.15319</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>网络上有这样的解决办法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ brew install zlib</span><br><span class="line">$ <span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-L/usr/local/opt/zlib/lib&quot;</span> </span><br><span class="line">$ <span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;-I/usr/local/opt/zlib/include</span></span><br></pre></td></tr></table></figure>

<p>但我安装后仍然存在这个问题，几经研究后，我发现可以通过下面的方法解决。</p>
<h3 id="步骤1-command-line-tools"><a href="#步骤1-command-line-tools" class="headerlink" title="步骤1 command-line tools"></a>步骤1 command-line tools</h3><p>在Xcode检查 command-line tools 的版本</p>
<ol>
<li>运行 Xcode.app</li>
<li>打开Preference &gt; Locations</li>
<li>选择正确的command-line tools版本</li>
</ol>
<p><img src="./python%20%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/1*I4eATihe-lAIOxpZ8tINrg-20210127172329408.png" alt="Image for post"></p>
<p><img src="./python%20%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/1*I4eATihe-lAIOxpZ8tINrg.png" alt="Image for post"></p>
<h3 id="步骤2-安装-python"><a href="#步骤2-安装-python" class="headerlink" title="步骤2 安装 python"></a>步骤2 安装 python</h3><p>使用下面的命令来安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ CFLAGS=<span class="string">&quot;-I<span class="subst">$(brew --prefix openssl)</span>/include -I<span class="subst">$(brew --prefix bzip2)</span>/include -I<span class="subst">$(brew --prefix readline)</span>/include -I<span class="subst">$(xcrun --show-sdk-path)</span>/usr/include&quot;</span> LDFLAGS=<span class="string">&quot;-L<span class="subst">$(brew --prefix openssl)</span>/lib -L<span class="subst">$(brew --prefix readline)</span>/lib -L<span class="subst">$(brew --prefix zlib)</span>/lib -L<span class="subst">$(brew --prefix bzip2)</span>/lib&quot;</span> pyenv install --patch 3.6.8 &lt; &lt;(curl -sSL https://github.com/python/cpython/commit/8ea6353.patch\?full_index\=1)</span><br><span class="line"></span><br><span class="line">$ pyenv versions</span><br><span class="line">* system (<span class="built_in">set</span> by /Users/alvin/.pyenv/version)</span><br><span class="line">  3.6.8</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2020/12/03/%E4%BD%BF%E7%94%A8EC2%20+%20Docker%E5%BB%BA%E7%AB%8Bbuild%E5%92%8C%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/03/%E4%BD%BF%E7%94%A8EC2%20+%20Docker%E5%BB%BA%E7%AB%8Bbuild%E5%92%8C%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83/" class="post-title-link" itemprop="url">使用EC2 + Docker建立build和测试环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-03 00:41:44" itemprop="dateCreated datePublished" datetime="2020-12-03T00:41:44-05:00">2020-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-24 09:22:17" itemprop="dateModified" datetime="2021-02-24T09:22:17-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="使用EC2-Docker建立build和测试环境"><a href="#使用EC2-Docker建立build和测试环境" class="headerlink" title="使用EC2 + Docker建立build和测试环境"></a>使用EC2 + Docker建立build和测试环境</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>使用docker建立一个适用多种应用程序需要的测试环境</p>
<ol>
<li>支持多个字域名</li>
<li>提供免费的SSL支持（对app、小程序都是必须的）</li>
<li>一个MySQL数据库</li>
<li>自动编译</li>
<li>自动部署</li>
</ol>
<h2 id="配套"><a href="#配套" class="headerlink" title="配套"></a>配套</h2><ul>
<li><p>AWS EC2</p>
<ul>
<li>Proxy：Nginx</li>
<li>SSL：Let’s Encrypt</li>
<li>Docker + Docker Compose</li>
</ul>
</li>
<li><p>AWS RDS MySQL </p>
</li>
</ul>
<h2 id="使用Nginx建立Proxy"><a href="#使用Nginx建立Proxy" class="headerlink" title="使用Nginx建立Proxy"></a>使用Nginx建立Proxy</h2><h1 id=""><a href="#" class="headerlink" title=""></a><img src="./%E4%BD%BF%E7%94%A8EC2%20+%20Docker%E5%BB%BA%E7%AB%8Bbuild%E5%92%8C%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83/image-20201203091044504.png" alt="image-20201203091044504"></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Ensure that your version of snapd is up to date</span><br><span class="line">sudo snap install core; sudo snap refresh core</span><br><span class="line"></span><br><span class="line"># Install Certbot</span><br><span class="line">sudo snap install --classic certbot</span><br><span class="line"></span><br><span class="line"># Prepare the Certbot command</span><br><span class="line">sudo ln -s &#x2F;snap&#x2F;bin&#x2F;certbot &#x2F;usr&#x2F;bin&#x2F;certbot</span><br><span class="line"></span><br><span class="line"># Choose how you&#39;d like to run Certbot</span><br><span class="line"># Either get and install your certificates...</span><br><span class="line">sudo certbot --nginx</span><br></pre></td></tr></table></figure>

<p>Test automatic renewal</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --dry-run</span><br></pre></td></tr></table></figure>

<p>The command to renew certbot is installed in one of the following locations:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;crontab&#x2F;</span><br><span class="line">&#x2F;etc&#x2F;cron.*&#x2F;*</span><br><span class="line">systemctl list-timers</span><br></pre></td></tr></table></figure>



<h1 id="运行环境（build环境）"><a href="#运行环境（build环境）" class="headerlink" title="运行环境（build环境）"></a>运行环境（build环境）</h1><p>基于php:7.4-fpm搭建，然后进入docker实例中，安装必要的环境，然后build docker image用于部署。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install</span></span><br><span class="line">apt-get update &amp;&amp; apt-get install -y \</span><br><span class="line">    git \</span><br><span class="line">    curl \</span><br><span class="line">    libpng-dev \</span><br><span class="line">    libonig-dev \</span><br><span class="line">    libxml2-dev \</span><br><span class="line">    zip \</span><br><span class="line">    vim \</span><br><span class="line">    unzip</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clear cache</span></span><br><span class="line">apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install PHP extensions</span></span><br><span class="line">docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Installing PHP Composer on Ubuntu</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install wget php-cli php-zip unzip</span><br><span class="line">wget -O composer-setup.php https://getcomposer.org/installer</span><br><span class="line">php composer-setup.php --version=1.10.10 --install-dir=/usr/<span class="built_in">local</span>/bin --filename=composer</span><br><span class="line">composer --version</span><br></pre></td></tr></table></figure>



<h1 id="Laravel"><a href="#Laravel" class="headerlink" title="Laravel"></a>Laravel</h1><p>下面的要素的关系</p>
<ol>
<li>源代码（所以依赖还没有安装）</li>
<li>.env环境</li>
<li>docker image</li>
</ol>
<p>源代码要放到docker image中吗？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2020/12/01/%E4%BC%81%E4%B8%9A%E4%B8%8A%E4%BA%91%EF%BC%9A%E4%BD%BF%E7%94%A8AWS%20S3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/01/%E4%BC%81%E4%B8%9A%E4%B8%8A%E4%BA%91%EF%BC%9A%E4%BD%BF%E7%94%A8AWS%20S3/" class="post-title-link" itemprop="url">企业上云：使用AWS S3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-01 00:41:44" itemprop="dateCreated datePublished" datetime="2020-12-01T00:41:44-05:00">2020-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-24 09:21:51" itemprop="dateModified" datetime="2021-02-24T09:21:51-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="企业上云：使用AWS-S3"><a href="#企业上云：使用AWS-S3" class="headerlink" title="企业上云：使用AWS S3"></a>企业上云：使用AWS S3</h1><p><img src="./%E4%BD%BF%E7%94%A8S3%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6/image-20201203181142762.png" alt="image-20201203181142762"></p>
<h2 id="为什么使用AWS-S3"><a href="#为什么使用AWS-S3" class="headerlink" title="为什么使用AWS S3"></a>为什么使用AWS S3</h2><p>Amazon S3全称是Amazon Simple Storage Service， 是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能。这意味着各种规模和行业的客户都可以使用 S3 来存储并保护各种用例（如数据湖、网站、移动应用程序、备份和还原、存档、企业应用程序、IoT 设备和大数据分析）的数据，容量不限。Amazon S3 提供了易于使用的管理功能，因此您可以组织数据并配置精细调整过的使用权限控制，从而满足特定的业务、组织和合规性要求。Amazon S3 可达到 99.999999999%（11 个 9）的持久性，并为全球各地的公司存储数百万个应用程序的数据。</p>
<p>与百度网盘等免费存储服务相比，S3 没有政策风险，不会有人检查和删除你的数据，也不会有限速和强制安装客户端之类的事情。与 Dropbox / iCloud 等订阅存储服务相比，S3 按需付费的机制在一些情形下更为廉价。S3 便捷和不受限制的共享能力也是一个加分项。</p>
<h3 id="AWS-S3的商业优势"><a href="#AWS-S3的商业优势" class="headerlink" title="AWS S3的商业优势"></a>AWS S3的商业优势</h3><h4 id="极高的可靠性"><a href="#极高的可靠性" class="headerlink" title="极高的可靠性"></a>极高的可靠性</h4><p>Amazon S3 可达到 99.999999999%（11 个 9）的数据持久性，因为 S3 会自动创建并存储跨多个系统的所有 S3 对象的副本。这意味着您的数据在需要时可用，并可抵御故障、错误和威胁。</p>
<h4 id="满足各种场景的存储级别"><a href="#满足各种场景的存储级别" class="headerlink" title="满足各种场景的存储级别"></a>满足各种场景的存储级别</h4><p><img src="./%E4%BD%BF%E7%94%A8S3%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6/image-20201203181733222.png" alt="image-20201203181733222"></p>
<p>S3 智能分层通过在访问模式发生变化时在四个访问层之间移动对象来优化存储成本。有两个已针对频繁访问和不频繁访问而优化的低延迟访问层，可帮助您节省高达 40% 的存储成本；还有两个专为异步访问而设计的选择性加入存档访问层，对于很少访问的对象，可节省高达 95％ 的成本。 </p>
<p>上传或转换到 S3 智能分层的对象将自动存储在频繁访问层中。S3 智能分层的工作方式是监控访问模式，然后将连续 30 天未访问的对象移动到不频繁访问层。在您激活一个或两个存档访问层后，S3 智能分层会将连续 90 天未被访问的对象移动到存档访问层，然后在连续 180 天物访问后，将其移动到深度存档访问层。如果稍后访问了对象，S3 智能分层会将该对象移回频繁访问层。</p>
<p>没有任何检索费用，因此在访问模式发生变化时存储账单不会意外增加。了解有关<a target="_blank" rel="noopener" href="https://aws.amazon.com/cn/s3/cost-optimization/">优化存储成本</a>的信息。</p>
<h4 id="生命周期的管理"><a href="#生命周期的管理" class="headerlink" title="生命周期的管理"></a>生命周期的管理</h4><p>除了手动指定，或者使用 INTELLIGENT_TIERING 外，S3 其实还可以让我们在 bucket 上定义生命周期管理的策略（Policy），来自动转换对象的存储级别。</p>
<p>生命周期的管理可以做到： 1. 转换存储级别 2. 过期删除</p>
<h4 id="灵活高级别的数据安全"><a href="#灵活高级别的数据安全" class="headerlink" title="灵活高级别的数据安全"></a>灵活高级别的数据安全</h4><ol>
<li>访问限制ACL</li>
<li>多版本管理<br>不小心把数据删除了的痛，程序员应该都懂。但是，后悔药是没有的。版本管理的功能就极其重要了，有了它，你可以随时回到过去。当然，你要强行删除特定版本的数据也是可以的，它只是让这件事变得难一些而已。它甚至可以把 bucket 设置成只有通过 MFA 认证的请求才能实现永久删除。<br>要注意的是： 1. 打开版本控制的 bucket，是没法关闭的，顶多可以暂停。也就是说，暂停后的 bucket，新加对象的时候，版本 id 会设为 null。 2. 无论打开，或者暂停版本控制，对 bucket 内已经存在的对象是没有影响的。</li>
<li>锁定write-once-read-many (WORM)</li>
</ol>
<h4 id="很低的价格"><a href="#很低的价格" class="headerlink" title="很低的价格"></a>很低的价格</h4><p>S3 不是会员制的订阅服务，而是像水电一样按使用量计费。费用主要由两个部分组成：</p>
<ol>
<li><p>$0.023 每 GB 的存储费，这一部分按月收取。</p>
</li>
<li><p>$0.09 每 GB 的下载费。</p>
</li>
</ol>
<h2 id="使用AWS-S3"><a href="#使用AWS-S3" class="headerlink" title="使用AWS S3"></a>使用AWS S3</h2><p>AWS S3可以存储任何的文件，扔上去就是了。这里介绍一下使用很频繁的一些操作：通过AWS CLI来管理S3。</p>
<h3 id="安装pip-（如果还没有安装）"><a href="#安装pip-（如果还没有安装）" class="headerlink" title="安装pip （如果还没有安装）"></a>安装pip （如果还没有安装）</h3><p>检查是否已经安装pip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip --version</span><br></pre></td></tr></table></figure>

<p>如果没有安装，继续下面的操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3</span><br></pre></td></tr></table></figure>

<p>Python &gt;=3.4 can self-bootstrap pip with the built-in <a target="_blank" rel="noopener" href="https://packaging.python.org/key_projects/#ensurepip">ensurepip</a> module. Refer to the standard library documentation for more details. Make sure to <a target="_blank" rel="noopener" href="https://pip.pypa.io/en/latest/installing/#upgrading-pip">upgrade pip</a> after <code>ensurepip</code> installs pip.</p>
<p>使用get-pip.py安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;bootstrap.pypa.io&#x2F;get-pip.py -o get-pip.py</span><br><span class="line">python3 get-pip.py</span><br></pre></td></tr></table></figure>



<p>如果出现无法使用Python 3.5的问题，可以使用下面的方法安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#Looks like you upgraded pip to a version that doesn&#39;t support your Python version.</span><br><span class="line">#Uninstall pip and reinstall the system pip:</span><br><span class="line"></span><br><span class="line">sudo apt purge python-pip python3-pip</span><br><span class="line">sudo rm -rf &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python2.7&#x2F;dist-packages&#x2F;pip</span><br><span class="line">sudo rm -rf &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.4&#x2F;dist-packages&#x2F;pip</span><br><span class="line">sudo apt install python-pip python3-pip</span><br></pre></td></tr></table></figure>



<h3 id="安装AWS-CLI"><a href="#安装AWS-CLI" class="headerlink" title="安装AWS CLI"></a>安装AWS CLI</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install awscli</span><br></pre></td></tr></table></figure>



<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>查看文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 ls s3:&#x2F;&#x2F;bucket名称</span><br></pre></td></tr></table></figure>

<p>压缩文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zcvf FileName.tar.gz DirName</span><br></pre></td></tr></table></figure>

<p>上传到S3，您可以使用一条文件夹级命令执行多文件递归上传和下载。AWS CLI 将并列进行这些传输，以便获得更高的性能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 整个目录上传</span><br><span class="line">aws s3 cp myfolder s3:&#x2F;&#x2F;mybucket&#x2F;myfolder --recursive</span><br><span class="line"></span><br><span class="line"># 单个文件上传</span><br><span class="line">aws s3 cp filename s3:&#x2F;&#x2F;mybucket&#x2F;myfolder</span><br></pre></td></tr></table></figure>

<p>更多AWS S3命令请参考</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/"><code>aws s3</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/cp.html"><code>aws s3 cp</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/mb.html"><code>aws s3 mb</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/mv.html"><code>aws s3 mv</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/ls.html"><code>aws s3 ls</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/rb.html"><code>aws s3 rb</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/rm.html"><code>aws s3 rm</code></a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/s3/sync.html"><code>aws s3 sync</code></a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2020/11/17/AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/17/AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/" class="post-title-link" itemprop="url">AWS案例：静态网站</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-17 09:34:07" itemprop="dateCreated datePublished" datetime="2020-11-17T09:34:07-05:00">2020-11-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-24 09:42:23" itemprop="dateModified" datetime="2021-02-24T09:42:23-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="./AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/ZANGMedia_Post_HowToWriteGoodContent_20170824.jpg" alt="A Guide to Writing Effective Website Content | ZANG Media"></p>
<h1 id="为什么关注静态网站-静态内容"><a href="#为什么关注静态网站-静态内容" class="headerlink" title="为什么关注静态网站/静态内容"></a>为什么关注静态网站/静态内容</h1><blockquote>
<p>使用非常广泛，可以说它无处不在，甚至是你应用的大部分。</p>
</blockquote>
<p>静态网站，仅使用静态文件（如 HTML、CSS、JavaScript、图像和视频），并且不需要服务器或服务器端处理。</p>
<p>在实际应用中，我们会有这样的静态内容：</p>
<ol>
<li>静态博客（例如hexo）</li>
<li>静态内容（例如wordpress发布的文本、图片、视频）</li>
<li>系统缓存内容（例如电子商务系统中的商品图片，根据不同场景缩放了的缓存图片）</li>
<li>SPA应用程序</li>
<li>缓存资料</li>
<li>…</li>
</ol>
<p>优势：功能强大且价格低廉</p>
<h1 id="使用到的AWS服务"><a href="#使用到的AWS服务" class="headerlink" title="使用到的AWS服务"></a>使用到的AWS服务</h1><ul>
<li>S3<ul>
<li>存储静态内容</li>
<li>可以配置为托管静态网站</li>
</ul>
</li>
<li>CloudFront<ul>
<li>CDN（内容分发网络）</li>
<li>使您的网站加载速度更快</li>
</ul>
</li>
<li>Certificate Manager<ul>
<li>提供免费的 HTTPS 证书</li>
</ul>
</li>
<li>Route 53<ul>
<li>提供域名服务</li>
</ul>
</li>
</ul>
<h1 id="实战步骤"><a href="#实战步骤" class="headerlink" title="实战步骤"></a>实战步骤</h1><p>本文章以host静态网站为例。</p>
<ul>
<li>Admin管理员：管理和更新静态资源</li>
<li>Visitor访问者：浏览网站内容</li>
</ul>
<p><img src="./AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/image-20201208091207228.png" alt="image-20201208091207228"></p>
<h2 id="第一步：确定域名，并以域名建立S3-Bucket"><a href="#第一步：确定域名，并以域名建立S3-Bucket" class="headerlink" title="第一步：确定域名，并以域名建立S3 Bucket"></a>第一步：确定域名，并以域名建立S3 Bucket</h2><p>登录AWS Console，建立两个同名bucket，一个yourdomain，另一个<a href="http://www.yourdomain（例如：alvinz.xyz）">www.yourdomain（例如：alvinz.xyz）</a><br><img src="./AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/image-20201208092212228.png" alt="image-20201208092212228"></p>
<p>并进行如下的设置</p>
<h3 id="1-启用static-website-hosting"><a href="#1-启用static-website-hosting" class="headerlink" title="1. 启用static website hosting"></a>1. 启用static website hosting</h3><p>进入Bucket-&gt;Properties-&gt;Static Website Hosting</p>
<p><img src="./AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/image-20201208092712929.png" alt="image-20201208092712929"></p>
<p>保存后，你将可以看到Bucket Website Endpoint（稍后的设置会用到）<br><img src="./AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/image-20201208094523600.png" alt="image-20201208094523600"></p>
<h3 id="2-设置访问权限为publish"><a href="#2-设置访问权限为publish" class="headerlink" title="2. 设置访问权限为publish"></a>2. 设置访问权限为publish</h3><p>进入Bucket-&gt;Permissions</p>
<p><img src="./AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/image-20201208093309955.png" alt="image-20201208093309955"></p>
<p>并在Bucket Policy进行如下设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2008-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Sid&quot;: &quot;AllowPublicRead&quot;,</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;AWS&quot;: &quot;*&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: &quot;s3:GetObject&quot;,</span><br><span class="line">            &quot;Resource&quot;: &quot;arn:aws:s3:::你的Bucket名字（例如alvinz.xyz）&#x2F;*&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第二步：上传静态内容到S3"><a href="#第二步：上传静态内容到S3" class="headerlink" title="第二步：上传静态内容到S3"></a>第二步：上传静态内容到S3</h2><p>可以使用AWS console在网站上上传，也可以使用AWS CLI上传，详细请浏览另外一篇关于S3的文章。</p>
<p>至此，你就可以通过Bucket Website Endpoint浏览网站了。</p>
<h2 id="第三步：设置域名Route-53"><a href="#第三步：设置域名Route-53" class="headerlink" title="第三步：设置域名Route 53"></a>第三步：设置域名Route 53</h2><h2 id="第四步：设置cloudfront和SSL"><a href="#第四步：设置cloudfront和SSL" class="headerlink" title="第四步：设置cloudfront和SSL"></a>第四步：设置cloudfront和SSL</h2><h1 id="进阶：如何安全保护静态资源"><a href="#进阶：如何安全保护静态资源" class="headerlink" title="进阶：如何安全保护静态资源"></a>进阶：如何安全保护静态资源</h1><p>由 HTTPS 和其他安全标头保护 – 此解决方案在 AWS Certificate Manager (ACM) 中创建 SSL/TLS 证书，并将其附加到 CloudFront 分配。此证书使分配能够使用 HTTPS 安全地为您的域名网站提供服务。</p>
<p>此解决方案还使用 Lambda@Edge 向每个服务器响应添加安全标头。安全标头是 Web 服务器响应中的一组标头，它们告诉 Web 浏览器采取额外的安全预防措施。有关更多信息，请参阅此博客文章：使用 Lambda@Edge 和 Amazon CloudFront 添加 HTTP 安全标头。</p>
<p>通过 Internet 分发内容的企业经常会希望限制对文档、商业数据、媒体流或其他内容的访问权限，从而仅限付费客户等选定的用户可以请求这些内容。通过使用 CloudFront，我们可以设置地理限制、签名 URL、签名 Cookie 等额外的访问限制，从而根据不同的条件进一步限制对内容的访问。</p>
<p>CloudFront 的另一个安全功能是源访问身份 (OAI)，此功能会将 S3 存储桶及其内容限制为仅限 CloudFront 以及它所执行的操作可以访问。此博文中的 CloudFormation 模板包含了 OAI，以帮助确保您的内容得到保护和限制。</p>
<p><img src="AWS%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/4-v-2.png" alt="img"></p>
<p>CloudFront 包含额外的保护功能，防止恶意利用漏洞。为提供这些保护，CloudFront 集成了 Web 应用程序防火墙 <a target="_blank" rel="noopener" href="https://aws.amazon.com/waf/">AWS WAF</a>（它可帮助保护 Web 应用程序，防止常见的 Web 漏洞利用行为）以及 <a target="_blank" rel="noopener" href="https://aws.amazon.com/shield/">AWS Shield</a>（适用于在 AWS 上运行的 Web 应用程序的托管 DDoS 防护服务）。AWS WAF 可让您按自己指定的条件控制对内容的访问，例如按 IP 地址或内容查询的查询字符串值。然后 CloudFront 会在满足条件时返回请求的内容，或返回一个 HTTP 403 状态代码（禁止访问）。所有 CloudFront 客户都可免费享受 AWS Shield Standard 提供的自动防护。如果客户希望获得更深入的见解，增强风险化解能力，以及面对 DDoS 攻击时的成本保护，则可以使用 <a target="_blank" rel="noopener" href="https://aws.amazon.com/shield/tiers/">AWS Shield Advanced</a>。</p>
<p>关于安全保护的更多内容请浏览</p>
<h2 id="限制对内容的访问"><a href="#限制对内容的访问" class="headerlink" title="限制对内容的访问"></a>限制对内容的访问</h2><p>许多通过互联网分发内容的公司都希望限制对文档、业务数据、流媒体或面向一部分用户的内容的访问。要使用 Amazon CloudFront 安全地提供此内容，您可执行以下一个或多个操作：</p>
<ul>
<li><p><strong>使用签名 URL 或 Cookie</strong></p>
<p>您通过 CloudFront，使用签名 URL 或签名 Cookie 来提供此私有内容，从而限制面向选定用户（例如，付费用户）的内容的访问。有关更多信息，请参阅<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/PrivateContent.html">使用签名 URL 和已签名的 Cookie 提供私有内容</a>。</p>
</li>
<li><p><strong>限制对 Amazon S3 存储桶中内容的访问</strong></p>
<p>例如，如果通过使用 CloudFront 签名 URL 或签名 Cookie 来限制对内容的访问，您还会希望人员无法使用文件的直接 URL 查看文件。而是希望他们只能通过使用 CloudFront URL 访问文件，这样您的保护才会发挥作用。如果您使用 Amazon S3 存储桶作为 CloudFront 分配的源，您可以设置源访问身份 (OAI) 来管理对内容的直接访问。源访问身份是一种特殊的 CloudFront 用户身份，您可以将其与您的分配关联，这样就可以保护您的全部或部分 Amazon S3 内容。有关如何配置此功能的详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html">使用源访问身份限制对 Amazon S3 内容的访问</a>。</p>
</li>
<li><p><strong>使用 AWS WAF Web ACL</strong></p>
<p>您可以使用 Web 应用程序防火墙服务 AWS WAF 创建 Web 访问控制列表 (Web ACL) 来限制对内容的访问。根据指定的条件 (如请求源自的 IP 地址或查询字符串的值)，CloudFront 会使用所请求的内容或使用 HTTP 状态代码 403 (Forbidden) 来响应请求。有关更多信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/distribution-web-awswaf.html">使用 AWS WAF 控制对您的内容的访问</a>。</p>
</li>
<li><p><strong>使用地理限制</strong></p>
<p>您可以使用<em>地理限制</em> （也称为<em>地理阻止</em> ）禁止特定地理位置的用户访问您通过 CloudFront 分配提供的内容。配置地理限制时有多个选项可供选择。有关更多信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/georestrictions.html">限制您的内容的地理分配</a>。</p>
</li>
</ul>
<h1 id="进阶：让流程畅顺起来"><a href="#进阶：让流程畅顺起来" class="headerlink" title="进阶：让流程畅顺起来"></a>进阶：让流程畅顺起来</h1><p>使用 AWS CloudFormation 进行配置和部署 – 此解决方案使用 AWS CloudFormation 模板来设置所有组件，因此，您可以更多地关注网站的内容，而更少地关注配置组件。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2020/11/01/%E4%BD%BF%E7%94%A8docsify%E6%9E%84%E5%BB%BA%E4%B8%93%E4%B8%9A%E6%96%87%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/01/%E4%BD%BF%E7%94%A8docsify%E6%9E%84%E5%BB%BA%E4%B8%93%E4%B8%9A%E6%96%87%E6%A1%A3/" class="post-title-link" itemprop="url">使用docsify构建专业文档</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-01 00:41:44" itemprop="dateCreated datePublished" datetime="2020-11-01T00:41:44-04:00">2020-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-06 10:54:21" itemprop="dateModified" datetime="2020-11-06T10:54:21-05:00">2020-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>因为，除了写代码，我们还需要写文档。docsify可以让你很优雅的来写文档。<br>有docsify，程序员也爱写文档 </p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/11/01/%E4%BD%BF%E7%94%A8docsify%E6%9E%84%E5%BB%BA%E4%B8%93%E4%B8%9A%E6%96%87%E6%A1%A3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://alvinz.xyz/2020/11/01/%E5%86%99%E5%8D%9A%E5%AE%A2%EF%BC%8C%E4%BD%93%E9%AA%8C%E7%A8%8B%E5%BA%8F%E5%A4%96%E7%9A%84%E4%BC%98%E9%9B%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alvin.z">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="alvin.z | THINK & IMAGINE">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/01/%E5%86%99%E5%8D%9A%E5%AE%A2%EF%BC%8C%E4%BD%93%E9%AA%8C%E7%A8%8B%E5%BA%8F%E5%A4%96%E7%9A%84%E4%BC%98%E9%9B%85/" class="post-title-link" itemprop="url">写博客，体验程序外的优雅</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-01 00:41:44" itemprop="dateCreated datePublished" datetime="2020-11-01T00:41:44-04:00">2020-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-24 09:22:58" itemprop="dateModified" datetime="2021-02-24T09:22:58-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="./%E5%86%99%E5%8D%9A%E5%AE%A2%EF%BC%8C%E4%BD%93%E9%AA%8C%E7%A8%8B%E5%BA%8F%E5%A4%96%E7%9A%84%E4%BC%98%E9%9B%85/CleanShot%202020-11-02%20at%2009.18.22@2x.png" alt="CleanShot 2020-11-02 at 09.18.22@2x"></p>
<blockquote>
<p>今天是2020年11月1日，我开始写博客。</p>
</blockquote>
<h2 id="我喜欢0和1的世界"><a href="#我喜欢0和1的世界" class="headerlink" title="我喜欢0和1的世界"></a>我喜欢0和1的世界</h2><blockquote>
<p>程序员的世界丰富多彩，自由与严谨并存。</p>
</blockquote>
<p>我很喜欢软件世界，那是一个无边无尽、丰富多彩的世界，在里面，既有天马行空、也有严谨科学，那是一种充满无限可能的真实。用0和1构建起来的数字世界是我们生活的重要组成部分。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/11/01/%E5%86%99%E5%8D%9A%E5%AE%A2%EF%BC%8C%E4%BD%93%E9%AA%8C%E7%A8%8B%E5%BA%8F%E5%A4%96%E7%9A%84%E4%BC%98%E9%9B%85/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">alvin.z</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">alvin.z</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
